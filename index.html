<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Karusselli 4 KÜ — портал</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; }
    header { padding:20px; background:#020617; }
    h1 { margin:0; font-size:22px; }
    main { padding:20px; max-width:900px; margin:auto; }
    .card { background:#020617; padding:20px; border-radius:10px; margin-bottom:20px; }
    input, button {
      width:100%; padding:10px; margin-top:8px;
      border-radius:6px; border:1px solid #334155;
      background:#020617; color:#e5e7eb;
    }
    button { background:#2563eb; border:none; cursor:pointer; margin-top:12px; }
    button:hover { background:#1d4ed8; }
    .hidden { display:none; }
    .msg { margin-top:10px; }
    .ok { color:#22c55e; }
    .err { color:#ef4444; }
  </style>
</head>
<body>
<header>
  <h1>Karusselli 4 KÜ — портал</h1>
</header>

<main>
  <div id="auth" class="card">
    <h2>Регистрация</h2>
    <input id="reg_user" placeholder="Имя пользователя" />
    <input id="reg_pass" type="password" placeholder="Пароль (минимум 6)" />
    <input id="reg_apt" placeholder="Квартира" />
    <button onclick="register()">Создать аккаунт</button>
    <div id="reg_msg" class="msg"></div>

    <hr style="margin:20px 0">

    <h2>Вход</h2>
    <input id="log_user" placeholder="Имя пользователя" />
    <input id="log_pass" type="password" placeholder="Пароль" />
    <button onclick="login()">Войти</button>
    <div id="log_msg" class="msg"></div>
  </div>

  <div id="app" class="card hidden">
    <h2>Добро пожаловать</h2>
    <p id="user_info"></p>
    <button onclick="logout()">Выйти</button>
  </div>
</main>

<script>
  const API_BASE = "https://withered-lake-3ad8.andrei-voronenko836.workers.dev";

  function register() {
    fetch(API_BASE + "/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username: reg_user.value,
        password: reg_pass.value,
        apartment: reg_apt.value
      })
    })
    .then(r => r.json())
    .then(d => {
      reg_msg.textContent = d.ok ? "Регистрация успешна" : d.error;
      reg_msg.className = "msg " + (d.ok ? "ok" : "err");
    });
  }

  function login() {
    fetch(API_BASE + "/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username: log_user.value,
        password: log_pass.value
      })
    })
    .then(r => r.json())
    .then(d => {
      if (!d.ok) {
        log_msg.textContent = d.error;
        log_msg.className = "msg err";
        return;
      }
      localStorage.setItem("token", d.token);
      showApp(log_user.value, d.apartment, d.role);
    });
  }

  function showApp(user, apt, role) {
    auth.classList.add("hidden");
    app.classList.remove("hidden");
    user_info.textContent = `Пользователь: ${user}, квартира: ${apt}, роль: ${role}`;
  }

  function logout() {
    localStorage.clear();
    location.reload();
  }
</script>
</body>
</html>
