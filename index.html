<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
  <script>
    // GitHub Pages hardening: ensure trailing slash for directory URLs.
    // Prevents broken relative assets when opening .../<repo> (without ending "/").
    (function(){
      try{
        var p = location.pathname || "";
        var last = p.split("/").filter(Boolean).pop() || "";
        var looksLikeFile = last.indexOf(".") !== -1;
        if (!p.endsWith("/") && !looksLikeFile){
          location.replace(p + "/" + location.search + location.hash);
        }
      }catch(e){}
    })();
  </script>
  <title>Karusselli 4 KÜ — v1.118</title>
<script>
// v1.118: force default language to Estonian (ku_lang) before UI init
try{ localStorage.setItem("ku_lang","et"); }catch(e){}
</script>

  <style>

    :root{
      /* Palette D — Warm Light (v1.118) */
      --bg0:#FAFAF9;
      --bg1:#F5F5F4;
      --bg2:#F5F5F4;

      --card:#FFFFFF;
      --stroke:#E7E5E4;

      --text:#1C1917;
      --muted:#57534E;

      --good:#16A34A;
      --warn:#CA8A04;

      --shadow: 0 4px 16px rgba(0,0,0,.06);
      --radius:14px;

      --pill:rgba(0,0,0,.03);
      --pill2:rgba(0,0,0,.05);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans","Helvetica Neue",sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 20% 0%, rgba(37,99,235,.025), transparent 70%),
        radial-gradient(900px 500px at 80% 10%, rgba(37,99,235,.02), transparent 70%),

        linear-gradient(180deg, var(--bg0), var(--bg2));
      overflow-x:hidden;
    }
    body:before{
      content:"";
      position:fixed; inset:0;
      background-image: radial-gradient(rgba(0,0,0,.06) 1px, transparent 1px);
      background-size: 26px 26px;
      opacity:.10;
      pointer-events:none;
      mask-image: radial-gradient(900px 600px at 50% 30%, black 45%, transparent 70%);
    }

    .topbar{
      position:sticky; top:0; z-index:50;
      background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(250,250,249,.78));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--stroke);
    }
    .topbar-inner{
      max-width:1020px;
      margin:0 auto;
      padding:14px 16px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
    }
    .brand h1{margin:0; font-size:18px; font-weight:900; letter-spacing:.2px}
    .brand small{display:block; margin-top:4px; color:var(--muted); font-size:12px}

    .right-actions{display:flex; gap:10px; align-items:center; justify-content:flex-end}
    .status{
      display:flex; align-items:center; gap:10px;
      padding:8px 12px;
      border-radius:999px;
      background:var(--pill);
      color:var(--muted);
      border:1px solid var(--stroke);
      box-shadow: 0 8px 18px rgba(0,0,0,.06);
      font-size:12px; color:var(--muted);
      white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:50%}
    .dot.good{background:var(--good); box-shadow:0 0 0 3px rgba(53,208,127,.16)}
    .dot.bad{background:#ff4d4d; box-shadow:0 0 0 3px rgba(255,77,77,.14)}
    .btn{
      border:1px solid var(--stroke);
      background:var(--pill);
      color:var(--muted);
      color:var(--text);
      padding:8px 12px;
      border-radius:12px;
      font-weight:800;
      cursor:pointer;
    }
    .btn:hover{background:var(--pill2)}
    .btn.primary{
      background: linear-gradient(180deg, rgba(107,124,255,.95), rgba(79,101,255,.85));
      border-color: rgba(107,124,255,.35);
    }
    .btn.primary:hover{filter:brightness(1.05)}
    .btn.active{
      background: rgba(107,124,255,.22);
      border-color: rgba(107,124,255,.38);
    }

    .wrap{max-width:1020px; margin:0 auto; padding:18px 16px 28px}

    .auth-grid{display:grid; grid-template-columns: 1fr 1fr; gap:16px}
    @media (max-width:900px){ .auth-grid{grid-template-columns:1fr} }
    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
    }
    .card-pad{padding:16px}
    .card h2{margin:0 0 8px; font-size:16px; font-weight:900}
    .sub{margin:0 0 10px; color:var(--muted); font-size:12px}
    label{display:block; color:var(--muted); font-size:12px; margin-top:10px}
    input{
  width:100%;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid rgba(107,124,255,.55);
  background:#eef4ff;
  box-shadow:0 0 0 4px rgba(107,124,255,.16);
  outline:none;
  transition: box-shadow .15s ease, border-color .15s ease, background .15s ease;
}
    input:focus{
  border-color: rgba(107,124,255,.9);
  box-shadow:0 0 0 5px rgba(107,124,255,.22);
  background:#eef4ff;
}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    @media (max-width:520px){ .row{grid-template-columns:1fr} }
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .msg{margin-top:10px; font-size:13px}
    .msg.ok{color:var(--good)}
    .msg.err{color:#ff4d4d}
    .hint{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px dashed rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .hidden{display:none !important}

    
/* === AUTH INPUTS (v1.118 UI fix) === */
#authSection input,
#authSection textarea{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(107,124,255,.55);
  background:transparent;
  box-shadow:none;
  outline:none;
}
#authSection input:focus,
#authSection textarea:focus\{
  border-color: rgba\(107,124,255,.9\);
  box-shadow:none;
  background:transparent;
  outline:none;
\}

/* field widths — match mock (inputs are not full width) */
#authSection .auth-stack > div,
#authSection .register-grid .row > div{
  display:flex;
  flex-direction:column;
  align-items:flex-start;
}

/* default auth input width */
#authSection input,
#authSection textarea{
  width:min(100%, 280px);
}

/* narrower fields where needed */
#authSection #reg_pass{ width:min(100%, 220px); }
#authSection #reg_apt{ width:min(100%, 220px); }

/* button sizing/placement similar to mock */
#authSection .login-actions .btn.primary{ padding:8px 16px; border-radius:12px; }
#authSection .register-grid .actions .btn.primary{ padding:8px 16px; border-radius:12px; }

/* ensure rows don't stretch columns to full card width */
#authSection .register-grid .row{
  grid-template-columns: max-content max-content;
  justify-content:flex-start;
  column-gap:24px;
}
@media (max-width:520px){
  #authSection .register-grid .row{ grid-template-columns:1fr; }
  #authSection input, #authSection textarea{ width:100%; max-width: 320px; }
}

/* forgot link position — keep inline with button like mock */
#authSection .login-actions{
  display:flex;
  align-items:center;
  justify-content:flex-start;
  gap:16px;
  margin-top:12px;
  flex-wrap:nowrap;
}
#authSection .login-actions .muted{
  margin:0 !important;
  display:flex;
  align-items:center;
  line-height:1;
}
#authSection .login-actions a{ display:inline-block; padding:0; margin:0; }
@media (max-width:520px){
  #authSection .login-actions{ flex-wrap:wrap; }
}

/* === v1.118 precise auth sizing (per screenshot) === */

/* Narrow LEFT login card */
#authSection > .card:first-child{
  max-width: 420px;
}

/* Inputs even narrower */

/* Password + apartment slightly narrower */

/* Keep alignment clean */
#authSection .auth-stack > div,
#authSection .register-grid .row > div{
  align-items:flex-start;
}

/* On small screens allow full width */
@media (max-width:520px){
  #authSection > .card:first-child{
    max-width:100%;
  }
  #authSection input,
  #authSection textarea{
    width:100%;
    max-width:320px;
  }
}

/* === v1.118 align widths to bottom field (per arrows) === */

/* Reference width = apartment field */
#authSection #reg_apt{
  width: 210px;
}

/* Align indicated fields to the same width */
#authSection #log_user,
#authSection #log_pass,
#authSection #reg_user,
#authSection #reg_pass,
#authSection #reg_email{
  width: 210px;
}

/* Keep buttons unchanged */

/* === v1.118 HOME: Quick Status (final) === */
#page_home .qs88{ display:flex; flex-direction:column; gap:14px; margin-top:8px; }
#page_home .qs88-row{ display:grid; grid-template-columns: 56px 1fr; gap:14px; align-items:center; }
#page_home .qs88-icon{ width:56px; height:56px; display:flex; align-items:center; justify-content:center; }
#page_home .qs88-icon img{ width:56px; height:56px; display:block; }
#page_home .qs88-water{ transform: scale(1.2); transform-origin:center; } /* water x1.2 */
#page_home .qs88-title{ font-size:12px; color:var(--muted); margin-bottom:6px; }
#page_home .qs88-cards{ display:flex; gap:12px; align-items:stretch; flex-wrap:wrap; }
#page_home .qs88-card{ min-width:120px; padding:10px 12px; border:1px solid rgba(0,0,0,.10); border-radius:12px; background: rgba(255,255,255,.6); }
#page_home .qs88-num{ font-weight:900; font-size:18px; line-height:1; }
#page_home .qs88-num.ok{ color: rgba(34,197,94,.95); }
#page_home .qs88-num.bad{ color: rgba(239,68,68,.95); }
#page_home .qs88-lbl{ font-size:12px; color:var(--text); margin-top:6px; }
@media (max-width:720px){
  #page_home .qs88-row{ grid-template-columns:1fr; }
  #page_home .qs88-icon{ display:none; }
}

/* APP */
    .app-shell{display:grid; grid-template-columns: 1fr; gap:16px}
    .main{padding:14px; background: var(--card)}
    .tabs{display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; margin-bottom:12px}
    .tab{
      border:1px solid var(--stroke);
      background: var(--pill);
      color:var(--text);
      padding:8px 12px;
      border-radius:999px;
      font-weight:900;
      cursor:pointer;
    }
    .tab.active{background: rgba(37,99,235,.14); border-color: rgba(37,99,235,.25)}

    .page-title{margin:0 0 10px; font-weight:900; font-size:14px; color:var(--text)}
    .hero{
      background:
        radial-gradient(900px 520px at 20% 10%, rgba(37,99,235,.06), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.35));
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:12px;
      min-height:340px;
      position:relative;
      overflow:hidden;
    }
    .hero .caption{
      position:absolute; left:0; right:0; bottom:12px;
      text-align:center;
      color:rgba(233,238,252,.9);
      font-weight:800;
      font-size:12px;
      letter-spacing:.2px;
      text-shadow: 0 8px 20px rgba(0,0,0,.12);
    }
    .hero:after{
      content:"";
      position:absolute;
      width:160px;height:160px;
      right:48px; top:30px;
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), rgba(255,255,255,.04) 55%, transparent 70%);
      border:1px solid rgba(255,255,255,.10);
      opacity:.45;
    }
    .house-svg{width:100%; height:100%; display:block; opacity:.55}
    .house-wrap{
      position:absolute;
      left:50%;
      top:52%;
      transform:translate(-50%,-50%);
      width:min(820px, 96%);
      height:290px;
      border-radius:14px;
      overflow:hidden;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.55);
    }
    .house-wrap img{display:block;width:100%;height:100%;object-fit:cover;}

    .bottom-grid{display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin-top:14px}
    @media (max-width:900px){ .bottom-grid{grid-template-columns:1fr} }
    .mini{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:14px;
      min-height:150px;
    }
    .mini h4{margin:0 0 8px; font-size:13px; font-weight:900}
    .mini .muted{color:var(--muted); font-size:12px; line-height:1.45}
    ul{margin:10px 0 0 16px; color:var(--muted); font-size:12px; line-height:1.6}
    .status-cards{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px}
    .stat{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.015);
      border-radius:14px;
      padding:10px;
      box-shadow: 0 8px 18px rgba(0,0,0,.06);
    }
    .stat .num{font-size:18px; font-weight:1000; color:var(--text); line-height:1}
    .stat .lbl{font-size:11px; color:var(--muted); margin-top:3px}

    table{width:100%; border-collapse:separate; border-spacing:0 10px}
    th{font-size:12px; color:var(--muted); text-align:left; font-weight:800; padding:0 10px}
    td{
      background: rgba(0,0,0,.015);
      border:1px solid var(--stroke);
      padding:10px;
      font-size:13px;
    }
    td:first-child{border-radius:12px 0 0 12px}
    td:last-child{border-radius:0 12px 12px 0}
    .ok{color:var(--good); font-weight:900}
    .warn{color:var(--warn); font-weight:900}
  
    .modal{position:fixed; inset:0; z-index:2000}
    .modal-backdrop{position:absolute; inset:0; background:rgba(0,0,0,.35)}
    .modal-card{position:relative; width:min(720px, 92vw); margin:8vh auto 0; background:var(--card); border:1px solid var(--stroke); border-radius:16px; box-shadow: var(--shadow); overflow:hidden}
    .modal-head{display:flex; align-items:center; justify-content:space-between; padding:14px 14px 10px; border-bottom:1px solid var(--stroke)}
    .modal-body{padding:14px}
    .iconbtn{border:1px solid var(--stroke); background:var(--pill); border-radius:10px; padding:8px 10px; cursor:pointer}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:720px){.grid2{grid-template-columns:1fr}}

textarea{
  width:100%;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid rgba(107,124,255,.55);
  background:#eef4ff;
  box-shadow:0 0 0 4px rgba(107,124,255,.16);
  outline:none;
  transition: box-shadow .15s ease, border-color .15s ease, background .15s ease;
}
textarea:focus{
  border-color: rgba(107,124,255,.9);
  box-shadow:0 0 0 5px rgba(107,124,255,.22);
  background:#eef4ff;
}

    /* ====== v1.118 menu layout ====== */
    .langSelect{
      appearance: none;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      font-weight: 700;
      cursor: pointer;
    }
    .app-header{
      display:flex;
      justify-content:center;
      padding: 6px 0 10px;
    }
    .app-title{
      font-size: 20px;
      font-weight: 800;
      letter-spacing: .2px;
    }
    .app-navrow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 8px 0 14px;
      border-top: 1px solid rgba(0,0,0,.06);
      border-bottom: 1px solid rgba(0,0,0,.06);
      margin-bottom: 12px;
    }
    .tabs-left{ margin: 0; }
    .nav-right{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

  /* === v1.118 language flag in selector === */
.langWrap{
  display:inline-flex;
  align-items:center;
  gap:8px;
}
.langFlag{
  width:18px;
  height:12px;
  border-radius:2px;
  display:block;
  box-shadow: 0 0 0 1px rgba(0,0,0,.08);
}
/* === v1.118: language flag + selector layout fixes === */
.right-actions{
  display:flex;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
.langWrap{
  display:inline-flex;
  align-items:center;
  gap:8px;
  white-space:nowrap;
}
.langFlag{
  width:18px;
  height:12px;
  border-radius:2px;
  display:block;
  box-shadow: 0 0 0 1px rgba(0,0,0,.08);
}
</style>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <h1 id="brandTitle">Karusselli 4 KÜ</h1><span id="versionBadge" style="margin-left:10px;font-size:12px;opacity:.75;white-space:nowrap">v1.118</span>
        <small id="brandSub"></small>
      </div>

      <div class="right-actions" id="topRightActions">
        <div class="langWrap" id="langControl" title="Language">
  <img id="langFlag" class="langFlag" alt="EST" src="data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='12' viewBox='0 0 18 12'%3E %3Crect width='18' height='12' fill='%23fff'/%3E%3Crect width='18' height='4' fill='%230072CE'/%3E%3Crect width='18' height='4' y='4' fill='%23000'/%3E%3Crect width='18' height='4' y='8' fill='%23fff'/%3E%3C/svg%3E">
  <select id="langSelect" class="langSelect" aria-label="Language">
          <option value="et">EST</option>
          <option value="ru">RU</option>
          <option value="en">EN</option>
        </select>
</div>

        <div class="status" id="statusPill">
          <span id="statusDot" class="dot bad"></span>
          <span id="statusText">Вход не выполнен</span>
        </div>

        <button class="btn" id="btnTopLogout" style="display:none">Выйти</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- AUTH -->
    <section id="authSection" class="auth-grid">
      <div class="card card-pad">
        <h2 id="loginTitle">Войти</h2>
        <p class="sub" id="loginSub">Введите имя пользователя и пароль.</p>

        
<div class="auth-stack">
  <div>
    <label id="loginUserLabel">Имя пользователя</label>
    <input id="log_user" placeholder="например: member12" autocomplete="username"/>
  </div>
  <div>
    <label id="loginPassLabel">Пароль</label>
    <input id="log_pass" type="password" placeholder="••••••••" autocomplete="current-password"/>
  </div>
</div>

<div class="login-actions">
  <button class="btn primary" id="btnLogin">Войти</button>
  <div class="muted">
    <a href="#" id="forgotLink" style="text-decoration:none" data-i18n="forgot">Forgot password?</a>
  </div>
</div>

<div id="log_msg" class="msg"></div>
      </div>

      <div class="card card-pad">
        <h2 id="registerTitle">Создать аккаунт</h2>
        <p class="sub" id="registerSub">Создайте имя пользователя и пароль.</p>

        
<div class="register-grid">
  <div class="row">
    <div>
      <label id="regUserLabel">Имя пользователя</label>
      <input id="reg_user" placeholder="например: test1" autocomplete="username"/>
    </div>
    <div>
      <label id="regPassLabel">Пароль</label>
      <input id="reg_pass" type="password" placeholder="минимум 6 символов" autocomplete="new-password"/>
    </div>
  </div>

  <div class="row">
    <div>
      <label id="regEmailLabel">Username or email</label>
      <input id="reg_email" type="email" placeholder="name@example.com" autocomplete="email"/>
    </div>
    <div></div>
  </div>

  <div class="row">
    <div>
      <label id="aptLabel">Квартира</label>
      <input id="reg_apt" placeholder="например: 5" inputmode="numeric"/>
    </div>
    <div></div>
  </div>

  <div class="actions">
    <button class="btn primary" id="btnRegister">Создать аккаунт</button>
  </div>

  <div id="reg_msg" class="msg"></div>
</div>

      </div>
    </section>

    <!-- APP -->
    <section id="appSection" class="app-shell hidden">
      <section class="card main">
        
        <div class="app-header">
          <div class="app-title" id="appPortalTitle">Karusselli 4 KÜ портал</div>
        </div>

        <div class="app-navrow">
          <div class="tabs tabs-left">
            <button class="tab active" id="tab_home" data-page="home">Главная</button>
          <button class="tab" id="tab_readings" data-page="readings">Показания</button>
          <button class="tab" id="tab_bills" data-page="bills">Счета</button>
          </div>
          <div class="nav-right" id="appRightControls"></div>
        </div>

<!-- HOME -->
        <div id="page_home">
          <div class="page-title" id="homeTitle">Главная</div>

          <div class="hero">
            
<div class="house-wrap">
  <img src="assets/images/197c2921-703f-422f-835d-02840e15c0ca.png"
       alt="Karusselli 4"
       style="width:100%;height:100%;object-fit:cover;border-radius:14px;"/>
</div>
            <div class="caption" id="heroCaption">Karusselli 4</div>
          </div>

          <div class="bottom-grid">
            <div class="mini">
              <h4 id="contactTitle">Контактная информация</h4>
              <div class="muted"><b id="boardMembersTitle">Члены правления</b></div>
              <ul>
                <li><span id="chairmanTitle">Председатель</span>: <span id="phName1">[имя фамилия]</span> — <span id="phEmailPhone1">[email]/телефон</span></li>
                <li><span id="boardMemberTitle">Член правления</span>: <span id="phName2">[имя фамилия]</span> — <span id="phEmailPhone2">[email]/телефон</span></li>
              </ul>
              <div class="muted" style="margin-top:10px"><b id="addressTitle">Адрес</b><br/><span id="addrLine">Karusselli 4, [город], Estonia</span></div>
              <div class="muted" style="margin-top:10px"><b id="bankDetailsTitle">Банковские реквизиты</b><br/>
                IBAN: <span id="phIban">[EE.. ..]</span><br/>
                <span id="bankTitle">Банк</span>: <span id="phBank">[Swedbank / SEB / ..]</span><br/>
                <span id="recipientTitle">Получатель</span>: Karusselli 4 KÜ
              </div>
            </div>

            <div class="mini">
              <h4 id="quickTitle">Быстрый статус</h4>

<!-- v1.118: New Quick Status layout (no totals, no legacy cards, no demo note) -->
<div class="qs88">
  <div class="qs88-row">
    <div class="qs88-icon">
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABcCAYAAAAFxhkcAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAFxEAABcRAcom8z8AABe/SURBVHhe7VxndJzVmeZPzv7c/ZGzu8kSajam2TQTSIDYEHqHhBI2gDEQwgZCS+glDUJwIDmmLC0kgNfYgGPAltWlGVVLVpdlq81885XpvRfN6NnzvGOBLUujMpLsrPWc852Rvu/eKc9973vfdu9hWMS847DxNxYx91gkeQGwSPICYJHkBcAiyQuARZIXAIskLwAWSV4ALJK8AFgkeQ/S2VFEMzlkcqPjHxWNRZIBuJMjqHPF8akWQac/gezo3BJ9yJOcGMlhnRrGJQ0Gzqyw4eFON/pDqfHNisIhTXIwncUmPYIrG+34ly0WHL3FivPNBl7Y5cOuUAq5OZLoQ5bkeCaHTVoE59Xp+GapFbdud+CVgQBWt7txSqWKx3o8GAqnx3ebFQ5JkmOZLNarYVxQp+PwEgvu3uFCuzeB3cEkHuh04582DeGrn1vwRI8XA+HiVcchRzJVxGYjgu/XGfhGiRV3tzrR5UtCj2Xw5lAA19UbOLPShn/fYsGyCht+2+vFrmASxWiOQ4rkaCaLjVoU59cbOGKbFT/Z4cQOXwKeeAZvDQVwerWK8+sMvD4UxMv9AVxYq+HEEise63RjODJ7iT5kSI6N5LDNEcVNzQ4sKbfhnnYXuv0JOGMZvDYYwOlVKo6vUvHcQACOxAgiqSzeHQ7i7EpViH68y42+WVodByXJnJp0CpLZUSEnkskhlM7Bl8rCmcxf3lQWoUz+GduwLftMNq1J3DO9XpxcquCyWg2f61EY8Qz+NhzEGVUqllSpeHEwAFcy+0UfT3IEH1hDOLvShiVbrXi2x4Pd4dSknzEZDjqSOaW5qje44/hMj+D94SBe7ffj971ePNPtxeNdHjzW5cEz3R68uNOH1/r90oZt2WcwnEY4/SVRY/Aks1jT58PyMgWnlSvyXq/0+3GxWcdZNRpeGAzAFhsZ300GlqpkBSV9qxWPdLgxNMPF8MCTPAr4U1kMhlMod8bwx6EgHuny4OEdLtzb4sBdTXbc2mDg+jod15p0XG3OX9eZddxUZ+C2ekPa3NvqwENtLjzd48WrQ0Fsc8S+IJwD1+ZL4OEON06rULC0QsFpFTYsK1NwZrWKlwcDCGX2H5gxBFMj+JslhPOqVCwvt+E3O7151TFNkT6gJIczOfQEU9hoC+P5Hg+ubzTwn1UqTqpUcUOdjvtbnfhVFyXWi7W7/XhjIIC3BwN4eyiANwYDco/PftXpxgM7nLihXse51RrOqlZxQ4NdpP8zLSLXUz0enFxhk8WNZtqFdQb+basFNzU5YHLFx3+1/eBNjeB9SwjfqdJwbKmCJ3s8GJymjj4gJGdzo+j2J7F2IID/2u7AJWYdPzDruIVS2+bCM7t8+MgWRq0zjjZfUqTGEklDi2VEj/Li38ORNPqCKZFSErWBg7XLh3vaXFjVZMfNDQYurjPw7WoVR5UrOKtWx4v9AXQGUnhPDeP7dRpOL7fh2W4vbNGpHY9KI4qLa3Uc9tEA/pV2dPf0HJYFJZnkOuIZbNYjuLfdhRU1Ks6otOHKBgO/7vViqx5BXzCJSIGpOxUCqSx6g0ls0yP4Q58PFzTY8Y1tCv65xIqVZgNvDIWgRDMIpLN4XwnhnGoVS0ut+HWPR1zpiZDJ5tDoSch3vtys4yKTjpMqbFhRq+G5Ph86AklZfCdTHgtGciI7ig5/Uhab8806jii34YoGQ/6vdsXlh9NSyM1BqJGDybClFh9BmTOONbv9uKnJjiVlNlnk1vT7MBxNQ4/nif5elQ3HleStB86Y8Wj1xPGTHS4cXabITCtzxPChLSzf/7hyGx7v9khQabJYx4KQHEnnsF6P4sZWJ1ZWq1hZo+GWNhc+1CNwxjOy+M0bRiGfYXbG8FCnBydV2nBcpYJ7O91o8iRF9fzFEsS5XAtoD3e69yJ6FK3eBG5rceDIUisubXSgxB2XBa/Pn8AFZh2HbRrEDc0O9PrpFU78Q+adZF8yiw1qBN9vsONrpQqurDfw7lBQpmZ6DqR2JqDefXHAj5NrNRxJj6/ViTJnFEo0jXVUHZUqTiix4rmdPpHMDl8CD7W7cUyZgoua7KhyJ+R9lEgaz+304vhyBSfSvh4IwE5hmQTzSjLNpw+UMM416Ti6VMEdrU58bkTFyJ9X6S0ALZ7Bu0oYlzfYcWKZgh8121HlisFIjOADJSSz7PgyRWIa9+1wYXmViutbnEIwhYKzgoPANrRU1g4FMBRJFxSYeSM5nM7hPVsYK80aji614q5Wp0y9kWxufNMFRyydw6dGFD9stmNJqYLVLU5s9ybFXl9nC+OcGg3/sdWCb5UpuLqREpw38YxYBs/0eHFcmSIL3/P9/oISPIZ5ITmWyaHUHsPF9XYJxNzb7kSbNzFd231BkBwZRakzhh81O3BSmQ0/3eFCJ62ETFZMwe+YdRxeqohF0RtIwhbN4A+7fELwCZU2vCQqYn8PcSLMC8mN3gRWtzqxrFzB7dsdaPTEMZI9iBjeg+hIDp/boziPYc8yBU/3euFPZMQMXNPvx9JyG5ZV2vBolxtPdXtFepdWqljTTxd8agkew5yT7EuOYM0uH5ZVKLimTkeNPYaRAvrqQIOS+6olhFNrNZxSZcMfd/vFJv5Vrw8nlttkJh67zYpjtllxSrWGF/r9cCWmJ8FjmFOSGQnbYkTxo0ZDHI2X+/0iFZPhYKGe3uPLAwGcWK3ilEobVm934MxaDd+t0/FgpwcrzLo8o4qgXp4p5oxk2oi9oRRuaXXh+AoFD3a60RVIjm/2BeISwswiM05RM1zJDDI9KE7nkXHPx/rtvZrzL9ZN8Bn78Ro/exLZnDgobMO/xz8fCKfxsw43lmyz4rQyBdc22fGWEkJ3MIX1WgRrLUEMTcP1nghzRjKD3BuUML5To+Eck44t9iiSI/taEiTQmRiRiBvt5F3hFIYiKYn1khiu7vQKW30Jidv2h1NicvG+Kzkiiw/tV/ble3Dh4UAwgsZ77Mv3ZF81tm8/5up2h1LYGUxJvMNLM3Lcd6uwx3BFvSGOxyM9HhixPKmpbA7BVBaTO86FMWck9wRSeLrLg2vrdPy+zyfEjQfza2VGFB8qIdS6YmjyJlDhiKLcEcVgJC0EMBvxniWEenccTZ4Emjxx1LtjKLNH5WIRCnVmpSP/P4ljoIhxj01qGHXuOBo87Mt+cWlTao/CvKdfuT2KLXoE/aH9pdIRy+CBHi++XmHDne0u9Acnn4kzwZyQTIl92xbGd006bm62w+SITujHU7JIxEdKGAORlKzQzLFtNSIive3+JD7VI6hxxmGNpkUCt3vj+EQN5QfGGRNC2Y9t2Y+EcnBI4A5/ApZoWjw42uT8rPVKCFWMLUfSUGIZieptM6ITppIY89igR3BFox23NtmxTYuIFBeLokkmlVo0gwd7vDiywob7uzxQRXftTzIlmZLLDMbY1GOJlEieN4HeYF4VMBsxBkrqRltICKOqGHtXtqFpaHLHpQ9nTjL3JSEM2H9sC+NjNSzqIbunpzeZRbM3IaRPBIYuGaO+uk7HU71e6BPMyJmiaJJTuVGZlne3OHGhScf7SnjSor0xkjmVx8BcXZM3Lj+c0sUFKJD+kizqUpL8dzW8Tw0E2zR74zC74zIQ7uS+iyglniR/oob3CWH6Uzm0+CYnOZrOShLhDLOOlY12mL2JaWdAJkPRJHPh+VAJ485GBx5sdWK7Jx9EmQiik+1RNO5xUwl/OosWb0IukjGeZC5wH9lC2KyG9wmQM4nKPhxgSjgHa29LZG+Sd++lf4PpwiQz1NriT+KiRjtOrdGwzhZBZIKc4UxQNMlMUL7U58Mt9Xa8xOhVgUwBSeaCZXLGxCKgRcG4Lu+RrO5gUrIclmjmC1Os05/EeiWIjUpIrAfGnGmGUb+yX40zJkF6kuZM5q0N9qOeJsmcBdT7Y5/HuDWzKLsLfE+qnkc6PbjMpGFtvx/W6Mxt471RNMmMQP28zSWJzfeGQ2KiTQbaqc2ehEgzfzhJ48r/3nBQFicuVp9pYVmY2mUhzFsf66xBSd3TKuACSfub93mP/SnRJUbki/dlPw4a25NkvrINP6/aGcNmNSKDMBk4UMwnMoH7m26PDHQxKI7kUaDJl8AljXasNOv4VI9KcGgy0IHQ4xkJxGz3JsRyMLliIo27grSZ02JBUELluS8hpLId25Ag6m7eM+/px8WSUsy/STIXUPbjQFD90ArhwLIf35OLJQkvFNyh58o14GfbHfhFm0vMxmJQFMkM+mx1xHCaWcd36w3UuOJTpo/4mNOW/r89kRGdnMqOSuE1X6l+SABnBKc/1UMql5Oc3Nh9TmdaF2xPPZzvNwJjr34shuF78jk/j1YMPy/fLyffYzLw/SrsUTy0w4l7tjvEti4GRZFMqf1Yi+Jsk44rmx1om8G04o+fyArhnTFyxj+f7D7BNW/v5+Nb8NlE9ycC29HMfLTdhVUNdikpKAZFkUzngrHXK8y6JBoHI8UtEAcLOBAd/gSe7HTjxjpDfmMxKIpkhjXpUV1q1nFnq0tWbAoZpabwlVcb+bZ7t//y/r7P89f+96fq9+WzMQnm61QXZwMXSSZVrzHreN8aGvfLZ4aiSA6yIE8J4QyThgsb7Sh1xGAJp8VuPRguCTKF0uKiU49TLzNgVOiivU3dXe2M4oF2J64ya1J0WAyKIpne0f+qYSyt1SQD/MZQEDWOPcEcI4rSA3jxO9AUpD6lecdqJAaPGCgqdDEoRSuGpWC3NxtS2fTJgVQXjPtu1qM4l5WRJg2vDwWEZDG3HDGxfQ/URaIYutyshcWRoefH+MdU1+d6BBuUEH7X48WNdTp+XG/IYBWDokhm4LvSGcMl9YZUBa23hcTWZSyXF6NlC3kxw0E7fOzz6d0xJs1EaE8wiZ6x1wIXg0l0aF7rD4hlcU+zQwSmGBRFMkFjn9Xrl9cZ+LsWllKAAwkO/HTMtEKg07TJFsbPmp14rM29T6xlNiiaZErOYx0e3FBn4K/DgYJu9XyDQSMucHQmigEji38ZDGB1gx3P93rRXSCNNh0UTXIoncWru/24vcGONTu9GJgg4zDfkMqexIi4zQyj7h2Png2U2Aju7nBjhUnDq4OzS57ujaJJpsvKqXVns0NKm+haLzQYeKIeZfZkixERU2y2YFig1h3HOfV2LDNp+EiPSNlAMSiaZLqgDLjcybqxGh1/HgrKbs+FBOMbNL3etwTxqR4uimQWSDLHyFKtq5scaAtMXq05XRRNMsHgzLN9Pilfur/DLVWPCwmSzMQsTS9G9ehQzJYWbq94ssONq2o1PL/TO+NClokwJyQTrNa8rk7HTQ12bFQjEqBfCNBlJhGVjphEyxgnpvlWaKPNZKDA8rtfadZxGxOpRkR8gWJRFMmy124kLzOWcApPdLpwcoWKa1ucqHbH96u7mGuQFC54zIwwRs3ibSZQ6dnt5Fbd8R0KYRRQIxk83OWRzZR8ZT0zB7FYzJpkLhAmTwLv2MLoCDAlH8etLQ585bNhHFmmyI57/xxMtUKgpcZsCl1ompIcdJpwVB38PiwRmygsOhFokbw5HMT3TDrOMRt4T2U5wPT6ToVZkUyCaTve1eHGSdUq7u1w5yWgwoavbh3GWVU2/LLdLTUO8wlGy5hFods8ttiRGOYZW71JDIYzkkqaEqNAvSch516wivO3O32TJlpng5mTPDoqXh7tyG+WKbLT/thSq2xQWWHS8WSvF/d3uqVc66ke37SKpGcLksxoGVNFzJwQDG8y493qS2I4mkF8GsUp7sQI/rzbLxsor2mwo8mdmPYMmA5mRDIrbJhfo+RSJbDO4uluDy6rN3B4iRVXNeTDnZvsUZxt1nF6lYa1gwHZVjYfIKH8PlygGM6klcFFkPk/qguqALYpBNrYf1NCuKJOx6UmHW8OBfcpSZgLTJtk2ordgRTubnfhG9usOK9Wk5Q7FwfWXZxdq+GYChue3e2D2RPDi/1+nFqtYXmNhr8qoXmxNkgfA0D5koKYWBbMLDM7zeTrVDqV6bMSPYKL6w0cVabgkR6v1HYU7jVzTJvkHf4kftLuwhElVpxTo0q2IJeldZHDK4NB2cDCgumllTY8tdOLSlcMT+30yb4L5gDftISkMnKuwcFjZSjJlShaKCUZbG4dK0RWIpOTkwIowUeWWHFzq1MW8olq+IpFQZL5eXSb6fU82OWRzYLn1mhSxsQv6Utn8RclhBVmA+fX6rhvh1N2eHJDIiX5EzUiRdRcEFlO+641VDAVP1tQNzOGwswHSR9fezwebMtdsdc12HHEVgtuaLKL2ZfaY47ONQqSzO2uzEDTijim3IYLTDrWWUP54u3sKF6xhHAyt+5WqXhtICC2KQ9PuqbewOk87qDXh8/tMTzS7cGJFTYsr1bxpyn2vM0WFAjWwk3BrxyD86E1hAvNuqi9m7c7UOGIzatNX5BkppcYdDmiVMFXPh3G73Z6kUhn4c/kZJ/FydUqji+nyeOFvqeUieYd+1xUo+HsKk2sDW5EfGanTxbDM6pVIZ0Rs/lQH5PBnxwRFcZN5xfw2JtyBT9udaLaxT0t80cwUZBkSizTMeeZdDHXWEra6o3jAzWMs0w6TqiwYU2ff78d9uFMVnJrXK1PKFXwcKcHnxkxrB0OYmW9gdNoR3e4pU6Z+jOYmXqKzwZje6yZRX/HEsSt2+1y3gXPuOBJWSzn4jaI+UZBkmkrGokM1ith3NzswPIqDeebdPywwcBldTp+1+eDOkkxHolmvcKVdQaWVtjw0za36MENRgS/6PHgcpOGi2p1OTaB1fWdPu6hmzuJYsxhZyAlYdj/bndjWZWKb1fZcE+rA29bgugLp2UQFgIFSR4D1QaLqSnRPOvha58N49FOF6xTHBPDH8rKee7DOKnchp93uGWL7Vs896dCwdc/HcIZZQquM2lSHPPCQAAVzpjk2Ziv4yI2HaeA5WJczKhvmcdj3vGlwQDuaHPj5kY7LqrVcI5Zx+O9XrR44ojNgzlZCNMimaD+ZMb3e7UavrbFinvbnOgOTF6LPAau+IxjnFJhw9HbrFjNI29aHHIu5tUmHfe1OHBLox1LqzUcX61iVbMDL3R78dZgEJvUCGrcMXQE6b2lYU+wNoKbbbJS98akbXsgKXqVbd8ZDEoV5u1NBpZV2XBUpYofNNnxpz4fSowo1HhmXtTSVJg2yQSlZYMaFtfz1DIFD7a7CpagEn2hNO5pd+OEMkXOlDix1IozyhXc2mgXncyd+CwheL4/gNVtLtzR7MAdDQZurNflAI9Lef7QdgfubnPi0U4PnujKX7/sdOOnbU5c3uzA2fWGnP5yU52OVQ0G7myy4642J57a5cNmexTWSHperYepMCOSCR6axKNrzqtWsWSrRY4qaPPvb8Tz35ZAEvd1eXBqlYrbtjvwUp8f19brOGLrMK5ssMthImPgAFIv83jd1/v9eKLLLVlwHlDKmMjFJl1Kpq4151+vMutC7HKThuVmA9c3O/B4hxv/MxCQRbfLnxSL4mDAjEkmGEKkS00z7djPLSLRjOmOgXRz4+Tte2Ic1zfZpbp9OJyW7O8RJRYcS9vaGtpHwjiVaQ0w5sDQJW10xkI+UiP4wBrGX4eCeGcof9ATF8t1SlhmVokjJh4pq+9ZBCmbLA+AWpgMsyKZkLMsaNTXaPjWVoucDcEFa5RBpGAKq0lwqSJHyJQ6oggms9hqRHFFvV0cm9WdblR7pg7skyye/MJdS444a5DzBz0xWM/B4CI2VU30gcasSSYY9RKroyp/1OIvOt3YrEXwTJ8Px1WqQnC1IwpPYkSsDB50R8dmVRtVTHLBTKgDjaJIJqg6NiphXM1DRkusWFZuwyUmTXTwNnsU3sSI7Ba90Kzh8G1W3NXuku0G0zHN/r+gaJIJ2fu2x7w7bOMATipXRJXYoxk53vEiHtBRYsGqNqechVHsvrh/NMwJyQR19CdaGCtrdTnG4MWBIF4fCOCSOh1HlVpxe5tLCqsPFRWxN+aMZIJm2MdaGKtanDiFxy1usYh1IceD8fyhQ5BgYk5JJuQocx7wVKvLMbqr9ujgQ01F7I05J5mg+0tdzJAnc3AM/B/KmBeSCXqGkqVYgFDiwY55I3kRX2KR5AXAIskLgEWSFwCLJC8AFkleACySvAD4Pyf9Jm3UjiJVAAAAAElFTkSuQmCC" alt="water" class="qs88-water">
    </div>
    <div class="qs88-col">
      <div class="qs88-title" id="qsCurrTitle">Сводка по текущему месяцу</div>
      <div class="qs88-cards">
        <div class="qs88-card">
          <div class="qs88-num ok" id="qsReadOk">4</div>
          <div class="qs88-lbl" id="qsReadOkLbl">сдали показания</div>
        </div>
        <div class="qs88-card">
          <div class="qs88-num bad" id="qsReadBad">1</div>
          <div class="qs88-lbl" id="qsReadBadLbl">не сдали</div>
        </div>
      </div>
    </div>
  </div>

  <div class="qs88-row">
    <div class="qs88-icon">
      <img src="data:image/png;base64,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" alt="payment" class="qs88-pay">
    </div>
    <div class="qs88-col">
      <div class="qs88-title" id="qsPrevTitle">Сводка по прошлому месяцу</div>
      <div class="qs88-cards">
        <div class="qs88-card">
          <div class="qs88-num ok" id="qsPayOk">4</div>
          <div class="qs88-lbl" id="qsPayOkLbl">оплатили счета</div>
        </div>
        <div class="qs88-card">
          <div class="qs88-num bad" id="qsPayBad">1</div>
          <div class="qs88-lbl" id="qsPayBadLbl">не оплатили счета</div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</div>
</div>
</div>
              </div>
</div>
          </div>
        </div>

        <!-- READINGS -->
        <div id="page_readings" class="hidden">
          <div class="page-title" id="readingsTitle">Показания</div>
          <div class="muted" id="readingsDesc" style="font-size:12px">Статус показаний по каждой квартире за прошлый месяц (пока демо).</div>

          <table style="margin-top:10px">
            <thead>
              <tr>
                <th id="thApartment">Квартира</th>
                <th id="thStatus">Статус</th>
                <th id="thComment">Комментарий</th>
              </tr>
            </thead>
            <tbody id="readingsBody"></tbody>
          </table>

          <div class="muted" style="font-size:12px; margin-top:8px">
            <span id="nextReadings1">Следующий шаг: читать данные из листа</span> <b>Reminder</b> <span id="nextReadings2">и фильтровать по квартире/роли.</span>
          </div>
        </div>

        <!-- BILLS -->
        <div id="page_bills" class="hidden">
          <div class="page-title" id="billsTitle">Счета</div>
          <div class="muted" id="billsDesc" style="font-size:12px">Выставленные счета за весь период (пока демо).</div>

          <table style="margin-top:10px">
            <thead>
              <tr>
                <th id="thPeriod">Период</th>
                <th id="thApartment2">Квартира</th>
                <th id="thSum">Сумма</th>
                <th id="thStatus2">Статус</th>
              </tr>
            </thead>
            <tbody id="billsBody"></tbody>
          </table>

          <div class="muted" style="font-size:12px; margin-top:8px">
            <span id="nextBills1">Следующий шаг: подключим лист</span> “Invoices” <span id="nextBills2">и покажем счета только по квартире жильца.</span>
          </div>
        </div>

      </section>
    </section>
  </main>

  <script>
    // API (Cloudflare Worker proxy)
    const API_BASE = "https://withered-lake-3ad8.andrei-voronenko836.workers.dev";

    
    // Helpers
    function byId(id){ return document.getElementById(id); }
// i18n packs (full coverage for UI + demo strings)
    const I18N = {
      ru: {
        portal_title: "Karusselli 4 KÜ портал",
        brandTitle: "Karusselli 4 KÜ",
        brandSub: "",
        statusOut: "Вход не выполнен",
        statusIn: (u)=> `Вход выполнен: ${u}`,
        logout: "Выйти",

        loginTitle: "Войти",
        loginSub: "Введите имя пользователя и пароль.",
        userLabel: "Имя пользователя",
        passLabel: "Пароль",
        loginBtn: "Войти",
        forgot: "Забыли пароль?",

        regTitle: "Создать аккаунт",
        regSub: "Создайте имя пользователя и пароль.",
        aptLabel: "Квартира",
        regBtn: "Создать аккаунт",

        ph_user: "например: member12",
        ph_reg_user: "например: test1",
        ph_pass_login: "••••••••",
        ph_pass_reg: "минимум 6 символов",
        ph_apt: "например: 5",

        regOk: "Регистрация успешна. Теперь можно войти.",
        errReg: "Ошибка регистрации",
        errLogin: "Ошибка входа",

        tabHome: "Главная",
        tabReadings: "Показания",
        tabBills: "Счета",

        contactTitle: "Контактная информация",
        boardMembersTitle: "Члены правления",
        chairmanTitle: "Председатель",
        boardMemberTitle: "Член правления",
        phName: "[имя фамилия]",
        phEmailPhone: "[email]/телефон",
        addressTitle: "Адрес",
        bankDetailsTitle: "Банковские реквизиты",
        bankTitle: "Банк",
        recipientTitle: "Получатель",
        phIban: "[EE.. ..]",
        phBank: "[Swedbank / SEB / ..]",

        quickTitle: "Быстрый статус",
        quickSub: "Сводка по прошлому месяцу (демо-данные):",
        lblTotal: "квартир всего",
        lblDone: "сдали показания",
        lblMissing: "не сдали",
        quickNote: "Дальше подключим реальные данные: статусы можно показывать жильцу только по его квартире.",

        readingsDesc: "Статус показаний по каждой квартире за прошлый месяц (пока демо).",
        billsDesc: "Выставленные счета за весь период (пока демо).",
        thApartment: "Квартира",
        thStatus: "Статус",
        thComment: "Комментарий",
        thPeriod: "Период",
        thSum: "Сумма",

        nextReadings1: "Следующий шаг: читать данные из листа",
        nextReadings2: "и фильтровать по квартире/роли.",
        nextBills1: "Следующий шаг: подключим лист",
        nextBills2: "и покажем счета только по квартире жильца.",

        stSubmitted: "✅ Сдано",
        stWaiting: "⏳ Ожидается",
        commentDash: "—",
        commentReminder: "Напоминание: последний день месяца",
        billPaid: "Оплачено",
        billPending: "Ожидает оплаты",
        forgotPrompt: "Введите email или имя пользователя:",
        forgotSent: "Мы отправили код для сброса на ваш email. Проверьте входящие/спам.",
        resetCodePrompt: "Введите код из письма:",
        resetNewPassPrompt: "Введите НОВЫЙ пароль (мин 6):",
        resetDone: "Пароль обновлён. Теперь можно войти.",
        resetCodeSent: "Код отправлен. Введите его ниже.",
        forgotError: "Ошибка сброса пароля: ",
        missing_code: "Введите код из письма.",
        network_error: "Ошибка сети. Попробуйте ещё раз.",
        user_not_found: "Пользователь не найден.",
    reset_title: "Сброс пароля",
    reset_desc: "Введите имя пользователя или email, указанный при регистрации. Мы отправим код сброса.",
    username_or_email: "Имя пользователя или email",
    send_code: "Отправить код",
    new_password: "Новый пароль",
    continue: "Продолжить",
    close: "Закрыть",
    code_sent: "Код отправлен",
    sending: "Отправка…",
    verifying: "Проверка…",
    password_reset_ok: "Пароль изменён",
    missing_identifier: "Введите имя пользователя или email",
    missing_new_password: "Введите новый пароль",
    password_too_short: "Пароль слишком короткий (мин. 6 символов)",
    invalid_code: "Неверный или просроченный код",
    reset_done_close: "Готово",
      errAptTaken: "Эта квартира уже зарегистрирована. Используйте \"Забыли пароль?\" или обратитесь в правление.",
      errUserTaken: "Имя пользователя уже занято.",
      errEmailTaken: "Email уже используется.",
      errInvalidCreds: "Неверный логин или пароль.",
      errAccountLocked: "Слишком много попыток. Попробуйте позже.",
      errResetFailed: "Не удалось сбросить пароль. Проверьте код и попробуйте снова."
},

      et: {

        forgot: "Unustasid parooli?",
        brandTitle: "Karusselli 4 KÜ",
        brandSub: "",
        statusOut: "Pole sisse logitud",
        statusIn: (u)=> `Sisselogitud: ${u}`,
        logout: "Logi välja",

        loginTitle: "Logi sisse",
        loginSub: "Sisesta kasutajanimi ja parool.",
        userLabel: "Kasutajanimi",
        passLabel: "Parool",
        loginBtn: "Logi sisse",

        regTitle: "Loo konto",
        regSub: "Loo kasutajanimi ja parool.",
        aptLabel: "Korter",
        regBtn: "Loo konto",

        ph_user: "nt: member12",
        ph_reg_user: "nt: test1",
        ph_pass_login: "••••••••",
        ph_pass_reg: "vähemalt 6 märki",
        ph_apt: "nt: 5",

        regOk: "Registreerimine õnnestus. Nüüd saad sisse logida.",
        errReg: "Registreerimise viga",
        errLogin: "Sisselogimise viga",

        tabHome: "Avaleht",
        tabReadings: "Näidud",
        tabBills: "Arved",

        contactTitle: "Kontaktinfo",
        boardMembersTitle: "Juhatuse liikmed",
        chairmanTitle: "Esimees",
        boardMemberTitle: "Juhatuse liige",
        phName: "[ees- ja perekonnanimi]",
        phEmailPhone: "[e-post]/telefon",
        addressTitle: "Aadress",
        bankDetailsTitle: "Pangaandmed",
        bankTitle: "Pank",
        recipientTitle: "Saaja",
        phIban: "[EE.. ..]",
        phBank: "[Swedbank / SEB / ..]",

        quickTitle: "Kiire ülevaade",
        quickSub: "Eelmise kuu kokkuvõte (demo):",
        lblTotal: "kortereid kokku",
        lblDone: "esitasid näidud",
        lblMissing: "ei esitanud",
        quickNote: "Järgmisena ühendame pärisandmed: elanik näeb staatust ainult oma korteri kohta.",

        readingsDesc: "Näitude staatus iga korteri kohta eelmise kuu eest (demo).",
        billsDesc: "Esitatud arved kogu perioodi kohta (demo).",
        thApartment: "Korter",
        thStatus: "Staatus",
        thComment: "Kommentaar",
        thPeriod: "Periood",
        thSum: "Summa",

        nextReadings1: "Järgmine samm: loeme andmed lehelt",
        nextReadings2: "ja filtreerime korteri/rolli järgi.",
        nextBills1: "Järgmine samm: ühendame lehe",
        nextBills2: "ja näitame arveid ainult elaniku korteri kohta.",

        stSubmitted: "✅ Esitatud",
        stWaiting: "⏳ Ootel",
        commentDash: "—",
        commentReminder: "Meeldetuletus: kuu viimane päev",
        billPaid: "Makstud",
        billPending: "Ootab makset",
        forgotPrompt: "Sisesta email või kasutajanimi:",
        forgotSent: "Saatsime parooli lähtestamise koodi sinu e-postile. Kontrolli ka spam-kausta.",
        resetCodePrompt: "Sisesta e-kirjas olev kood:",
        resetNewPassPrompt: "Sisesta UUS parool (min 6):",
        resetDone: "Parool uuendatud. Nüüd saad sisse logida.",
        resetCodeSent: "Kood saadetud. Sisestage see allpool.",
        forgotError: "Parooli lähtestamise viga: ",
        missing_code: "Sisesta e-kirjas saadud kood.",
        network_error: "Võrgu viga. Proovi uuesti.",
        user_not_found: "Kasutajat ei leitud.",
    reset_title: "Parooli taastamine",
    reset_desc: "Sisesta registreerimisel kasutatud kasutajanimi või e‑post. Saadame taastamiskoodi.",
    username_or_email: "Kasutajanimi või e‑post",
    send_code: "Saada kood",
    new_password: "Uus parool",
    continue: "Jätka",
    close: "Sulge",
    code_sent: "Kood saadetud",
    sending: "Saatmine…",
    verifying: "Kontrollimine…",
    password_reset_ok: "Parool muudetud",
    missing_identifier: "Sisesta kasutajanimi või e‑post",
    missing_new_password: "Sisesta uus parool",
    password_too_short: "Parool liiga lühike (min 6 märki)",
    invalid_code: "Vale või aegunud kood",
    reset_done_close: "Valmis",
      errAptTaken: "See korter on juba registreeritud. Kasuta \"Unustasid parooli?\" või võta ühendust juhatusega.",
      errUserTaken: "Kasutajanimi on juba võetud.",
      errEmailTaken: "E-post on juba kasutusel.",
      errInvalidCreds: "Vale kasutajanimi või parool.",
      errAccountLocked: "Liiga palju katseid. Proovi hiljem uuesti.",
      errResetFailed: "Parooli lähtestamine ebaõnnestus. Kontrolli koodi ja proovi uuesti."
},

      en: {
        portal_title: "Karusselli 4 KÜ portal",
        brandTitle: "Karusselli 4 KÜ",
        brandSub: "",
        statusOut: "Not logged in",
        statusIn: (u)=> `Logged in: ${u}`,
        logout: "Log out",

        loginTitle: "Sign in",
        loginSub: "Enter your username and password.",
        userLabel: "Username",
        passLabel: "Password",
        loginBtn: "Sign in",
        forgot: "Forgot password?",

        regTitle: "Create account",
        regSub: "Create a username and password.",
        aptLabel: "Apartment",
        regBtn: "Create account",

        ph_user: "e.g.: member12",
        ph_reg_user: "e.g.: test1",
        ph_pass_login: "••••••••",
        ph_pass_reg: "min 6 characters",
        ph_apt: "e.g.: 5",

        regOk: "Registration successful. You can now sign in.",
        errReg: "Registration error",
        errLogin: "Sign-in error",

        tabHome: "Home",
        tabReadings: "Readings",
        tabBills: "Invoices",

        contactTitle: "Contact info",
        boardMembersTitle: "Board members",
        chairmanTitle: "Chairman",
        boardMemberTitle: "Board member",
        phName: "[name surname]",
        phEmailPhone: "[email]/phone",
        addressTitle: "Address",
        bankDetailsTitle: "Bank details",
        bankTitle: "Bank",
        recipientTitle: "Recipient",
        phIban: "[EE.. ..]",
        phBank: "[Swedbank / SEB / ..]",

        quickTitle: "Quick status",
        quickSub: "Summary for last month (demo data):",
        lblTotal: "apartments total",
        lblDone: "submitted readings",
        lblMissing: "missing",
        quickNote: "Next we’ll connect real data: residents should see status only for their apartment.",

        readingsDesc: "Reading status per apartment for last month (demo).",
        billsDesc: "Issued invoices for the whole period (demo).",
        thApartment: "Apartment",
        thStatus: "Status",
        thComment: "Comment",
        thPeriod: "Period",
        thSum: "Amount",

        nextReadings1: "Next step: read data from sheet",
        nextReadings2: "and filter by apartment/role.",
        nextBills1: "Next step: connect sheet",
        nextBills2: "and show invoices only for resident’s apartment.",

        stSubmitted: "✅ Submitted",
        stWaiting: "⏳ Pending",
        commentDash: "—",
        commentReminder: "Reminder: last day of month",
        billPaid: "Paid",
        billPending: "Payment pending",
        forgotPrompt: "Enter email or username:",
        forgotSent: "We sent a reset code to your email. Check inbox/spam.",
        resetCodePrompt: "Enter the code from the email:",
        resetNewPassPrompt: "Enter a NEW password (min 6):",
        resetDone: "Password updated. You can sign in now.",
        resetCodeSent: "Code sent. Enter it below.",
        forgotError: "Password reset error: ",
        missing_code: "Enter the code from the email.",
        network_error: "Network error. Please try again.",
        user_not_found: "User not found.",
    reset_title: "Password reset",
    reset_desc: "Enter the username or email used during registration. We will send a reset code.",
    username_or_email: "Username or email",
    send_code: "Send code",
    new_password: "New password",
    continue: "Continue",
    close: "Close",
    code_sent: "Code sent",
    sending: "Sending…",
    verifying: "Verifying…",
    password_reset_ok: "Password changed",
    missing_identifier: "Enter username or email",
    missing_new_password: "Enter new password",
    password_too_short: "Password too short (min 6 characters)",
    invalid_code: "Invalid or expired code",
    reset_done_close: "Done",
      errAptTaken: "This apartment is already registered. Use \"Forgot password?\" or contact the board.",
      errUserTaken: "Username is already taken.",
      errEmailTaken: "Email is already in use.",
      errInvalidCreds: "Invalid username or password.",
      errAccountLocked: "Too many attempts. Please try again later.",
      errResetFailed: "Password reset failed. Check the code and try again."
}
    };

    function getLang(){
      const saved = localStorage.getItem("ku_lang");
      if (saved && I18N[saved]) return saved;
      return "et";
    }

function getLangSafe(){
  try { return getLang(); } catch(e){ return 'ru'; }
}

    function setLang(lang){
      if (!I18N[lang]) return;
      localStorage.setItem("ku_lang", lang);
      applyLang();
      updateLangFlag_();
// if logged in — refresh table texts in current language
      const saved = localStorage.getItem("ku_user");
      if (saved){
        try { renderDemoTables(JSON.parse(saved)); } catch(_){}
      }
    }
    const TEXT = (typeof I18N !== "undefined" ? I18N : {});

    function tr(key){
      const lang = getLang();
      const pack = (TEXT[lang] || TEXT.ru || {});
      if (pack && Object.prototype.hasOwnProperty.call(pack, key)) return pack[key];
      const fallback = (TEXT.ru || {});
      if (fallback && Object.prototype.hasOwnProperty.call(fallback, key)) return fallback[key];
      return key;
    }
    function esc(s){ return String(s ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    function setStatus(isIn, username){
      const dot = document.getElementById("statusDot");
      const text = document.getElementById("statusText");
      const pack = I18N[getLang()] || I18N.ru;

      dot.classList.toggle("good", !!isIn);
      dot.classList.toggle("bad", !isIn);

      text.textContent = isIn ? pack.statusIn(username || "") : pack.statusOut;
      document.getElementById("btnTopLogout").style.display = isIn ? "inline-block" : "none";
    }

    function safeSetText(id, text){const el=document.getElementById(id); if(el) el.textContent=text;}

function applyLang(){
      const lang = getLang();
      const t = I18N[lang] || I18N.ru;

      document.documentElement.lang = (lang === "et" ? "et" : lang);

      // top
      document.getElementById("brandTitle").textContent = t.brandTitle;
      document.getElementById("brandSub").textContent = t.brandSub;
      document.getElementById("btnTopLogout").textContent = t.logout;

      // auth texts
      document.getElementById("loginTitle").textContent = t.loginTitle;
      document.getElementById("loginSub").textContent = t.loginSub;
      document.getElementById("loginUserLabel").textContent = t.userLabel;
      document.getElementById("loginPassLabel").textContent = t.passLabel;
      document.getElementById("btnLogin").textContent = t.loginBtn;

      document.getElementById("registerTitle").textContent = t.regTitle;
      document.getElementById("registerSub").textContent = t.regSub;
      document.getElementById("regUserLabel").textContent = t.userLabel;
      document.getElementById("regPassLabel").textContent = t.passLabel;
      document.getElementById("aptLabel").textContent = t.aptLabel;
      document.getElementById("btnRegister").textContent = t.regBtn;

      document.getElementById("log_user").placeholder = t.ph_user;
      document.getElementById("reg_user").placeholder = t.ph_reg_user;
      document.getElementById("log_pass").placeholder = t.ph_pass_login;
      document.getElementById("reg_pass").placeholder = t.ph_pass_reg;
      document.getElementById("reg_apt").placeholder = t.ph_apt;

      // app nav
      document.getElementById("tab_home").textContent = t.tabHome;
      document.getElementById("tab_readings").textContent = t.tabReadings;
      document.getElementById("tab_bills").textContent = t.tabBills;

      // page titles + blocks
      document.getElementById("homeTitle").textContent = t.tabHome;
      document.getElementById("readingsTitle").textContent = t.tabReadings;
      document.getElementById("billsTitle").textContent = t.tabBills;

      document.getElementById("contactTitle").textContent = t.contactTitle;
      document.getElementById("boardMembersTitle").textContent = t.boardMembersTitle;
      document.getElementById("chairmanTitle").textContent = t.chairmanTitle;
      document.getElementById("boardMemberTitle").textContent = t.boardMemberTitle;

      document.getElementById("phName1").textContent = t.phName;
      document.getElementById("phName2").textContent = t.phName;
      document.getElementById("phEmailPhone1").textContent = t.phEmailPhone;
      document.getElementById("phEmailPhone2").textContent = t.phEmailPhone;

      document.getElementById("addressTitle").textContent = t.addressTitle;
      document.getElementById("bankDetailsTitle").textContent = t.bankDetailsTitle;
      document.getElementById("bankTitle").textContent = t.bankTitle;
      document.getElementById("recipientTitle").textContent = t.recipientTitle;
      document.getElementById("phIban").textContent = t.phIban;
      document.getElementById("phBank").textContent = t.phBank;

      safeSetText("quickTitle", t.quickTitle);
      safeSetText("quickSub", t.quickSub);
      safeSetText("lbl_total", t.lblTotal);
      safeSetText("lbl_done", t.lblDone);
      safeSetText("lbl_missing", t.lblMissing);
      safeSetText("quickNote", t.quickNote);

// v1.118 quick status new layout labels (fallbacks if keys not present in I18N)
safeSetText("qsCurrTitle", (t.qsCurrTitle || (lang==="et" ? "Kokkuvõte käesolevaks kuuks" : (lang==="en" ? "Summary for current month" : "Сводка по текущему месяцу"))));
safeSetText("qsPrevTitle", (t.qsPrevTitle || (lang==="et" ? "Kokkuvõte eelmise kuu kohta" : (lang==="en" ? "Summary for previous month" : "Сводка по прошлому месяцу"))));
safeSetText("qsReadOkLbl", (t.qsReadOkLbl || (lang==="et" ? "esitasid näidud" : (lang==="en" ? "submitted readings" : "сдали показания"))));
safeSetText("qsReadBadLbl", (t.qsReadBadLbl || (lang==="et" ? "ei esitanud" : (lang==="en" ? "not submitted" : "не сдали"))));
safeSetText("qsPayOkLbl", (t.qsPayOkLbl || (lang==="et" ? "maksid arved" : (lang==="en" ? "paid bills" : "оплатили счета"))));
safeSetText("qsPayBadLbl", (t.qsPayBadLbl || (lang==="et" ? "ei maksnud" : (lang==="en" ? "not paid" : "не оплатили счета"))));

      document.getElementById("readingsDesc").textContent = t.readingsDesc;
      document.getElementById("billsDesc").textContent = t.billsDesc;

      document.getElementById("thApartment").textContent = t.thApartment;
      document.getElementById("thApartment2").textContent = t.thApartment;
      document.getElementById("thStatus").textContent = t.thStatus;
      document.getElementById("thStatus2").textContent = t.thStatus;
      document.getElementById("thComment").textContent = t.thComment;
      document.getElementById("thPeriod").textContent = t.thPeriod;
      document.getElementById("thSum").textContent = t.thSum;

      document.getElementById("nextReadings1").textContent = t.nextReadings1;
      document.getElementById("nextReadings2").textContent = t.nextReadings2;
      document.getElementById("nextBills1").textContent = t.nextBills1;
      document.getElementById("nextBills2").textContent = t.nextBills2;
      // status (header only)
const saved = localStorage.getItem("ku_user");
if (saved){
  try{
    const u = JSON.parse(saved);
    setStatus(true, u.username);
  }catch(_){
    setStatus(false);
  }
  try{ updateLangFlag_(); }catch(e){}
}else{
  setStatus(false);
}

// Apply generic i18n bindings (e.g. reset modal)
document.querySelectorAll("[data-i18n]").forEach(el => {
  const k = el.getAttribute("data-i18n");
  if (!k) return;
  el.textContent = tr(k);
});
document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
  const k = el.getAttribute("data-i18n-placeholder");
  if (!k) return;
  el.setAttribute("placeholder", tr(k));
});

// active lang button

      const bRu=document.getElementById("lang_ru"); if(bRu) bRu.classList.toggle("active", lang==="ru");
      const bEt=document.getElementById("lang_et"); if(bEt) bEt.classList.toggle("active", lang==="et");
      const bEn=document.getElementById("lang_en"); if(bEn) bEn.classList.toggle("active", lang==="en");
      const sel=document.getElementById("langSelect"); if(sel) sel.value = lang;
      }

    
    function mountControls(toApp){
      const top = document.getElementById("topRightActions");
      const app = document.getElementById("appRightControls");
      if (!top || !app) return;

      const nodes = ["langControl","statusPill","btnTopLogout"].map(id=>document.getElementById(id)).filter(Boolean);

      // place controls depending on current view
      const target = toApp ? app : top;
      nodes.forEach(n=>{ if (n.parentElement !== target) target.appendChild(n); });
    }
    function isAppVisible(){
      const app = document.getElementById("appSection");
      return app && !app.classList.contains("hidden");
    }

    function showAuth(){
      document.getElementById("authSection").classList.remove("hidden");
      document.getElementById("appSection").classList.add("hidden");
      setStatus(false);
      mountControls(false);
      applyLang();
    }

    function showApp(user){
      document.getElementById("authSection").classList.add("hidden");
      document.getElementById("appSection").classList.remove("hidden");
      mountControls(true);

      const t = I18N[getLang()] || I18N.ru;

      setStatus(true, user.username);

      renderDemoTables(user);
      navigate("home");
    }

    function markActive(page){
      document.querySelectorAll("[data-page]").forEach(el=>{
        el.classList.toggle("active", el.getAttribute("data-page") === page);
      });
      ["home","readings","bills"].forEach(p=>{
        document.getElementById("page_"+p).classList.toggle("hidden", p !== page);
      });
    }

    function navigate(page){
      markActive(page);
      history.replaceState(null,"", "#"+page);
    }

    function renderDemoTables(user){
      const t = I18N[getLang()] || I18N.ru;
      const role = user.role || "member";
      const apt = String(user.apartment || "");
      const apartments = (role === "board") ? Array.from({length:24}, (_,i)=>String(i+1)) : [apt];

      // readings demo
      const rb = document.getElementById("readingsBody");
      rb.innerHTML = "";
      apartments.slice(0, role==="board" ? 10 : 1).forEach((a,i)=>{
        const ok = (i % 3 !== 0);
        rb.insertAdjacentHTML("beforeend", `
          <tr>
            <td><b>${esc(a)}</b></td>
            <td class="${ok ? "ok":"warn"}">${ok ? esc(t.stSubmitted) : esc(t.stWaiting)}</td>
            <td>${ok ? esc(t.commentDash) : esc(t.commentReminder)}</td>
          </tr>
        `);
      });

      // bills demo
      const bb = document.getElementById("billsBody");
      bb.innerHTML = "";
      const demo = [
        {period:"2025-11", apt:apt || "—", sum:"123.45 €", st: t.billPaid, ok:true},
        {period:"2025-12", apt:apt || "—", sum:"98.10 €", st: t.billPending, ok:false},
      ];
      demo.forEach(x=>{
        bb.insertAdjacentHTML("beforeend", `
          <tr>
            <td><b>${esc(x.period)}</b></td>
            <td>${esc(x.apt)}</td>
            <td>${esc(x.sum)}</td>
            <td class="${x.ok ? "ok":"warn"}">${esc(x.st)}</td>
          </tr>
        `);
      });
    }

    async function apiPost(path, payload){
      // Robust fetch with timeout to avoid hanging UI when Apps Script is slow/unreachable
      const ctrl = new AbortController();
      const t = setTimeout(()=>ctrl.abort(), 20000); // 20s
      try{
        const res = await fetch(API_BASE + path, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload || {}),
          signal: ctrl.signal
        });
        const data = await res.json().catch(()=>({ ok:false, error:"Bad JSON" }));
        // If upstream returns non-2xx, still surface the payload error if present
        if (!res.ok && data && typeof data === "object" && !data.ok){
          data.http_status = res.status;
        }
        return data;
      }catch(err){
        const msg = (err && err.name === "AbortError") ? "Request timeout" : String(err);
        return { ok:false, error: msg };
      }finally{
        clearTimeout(t);
      }
    }

    // Compatibility alias used by forgot/reset helpers
    async function apiCall(path, payload){
      return apiPost(path, payload);
    }

    async function register(){
      const u = document.getElementById("reg_user").value.trim();
      const p = document.getElementById("reg_pass").value;
      const a = document.getElementById("reg_apt").value.trim();
      const e = document.getElementById("reg_email").value.trim();
      const msg = document.getElementById("reg_msg");
      msg.className="msg"; msg.textContent="";

      const d = await apiPost("/register", {username:u,password:p,apartment:a,email:e});
      const t = I18N[getLang()] || I18N.ru;

      if(d.ok){
        msg.className="msg ok";
        msg.textContent = t.regOk;
      }else{
        msg.className="msg err";
        const code = String(d.error||"");
if(code==="APARTMENT_TAKEN") msg.textContent = t.errAptTaken;
else if(code==="USERNAME_TAKEN") msg.textContent = t.errUserTaken;
else if(code==="EMAIL_TAKEN") msg.textContent = t.errEmailTaken;
else msg.textContent = d.error || t.errReg;
      }
    }

    async function login(){
      const u = document.getElementById("log_user").value.trim();
      const p = document.getElementById("log_pass").value;
      const msg = document.getElementById("log_msg");
      msg.className="msg"; msg.textContent="";

      const d = await apiPost("/login", {username:u,password:p});
      const t = I18N[getLang()] || I18N.ru;

      if(!d.ok){
        msg.className="msg err";
        const code = String(d.error||"");
if(code==="ACCOUNT_LOCKED") msg.textContent = t.errAccountLocked;
else if(code==="INVALID_CREDENTIALS") msg.textContent = t.errInvalidCreds;
else msg.textContent = t.errLogin;
        return;
      }

      const user = { username:u, apartment:d.apartment, role:d.role || "member" };
      localStorage.setItem("ku_user", JSON.stringify(user));
      localStorage.setItem("ku_token", d.token || "");
      showApp(user);
    }

    function logout(){
      localStorage.removeItem("ku_user");
      localStorage.removeItem("ku_token");
      showAuth();
    }

    // wire
    document.getElementById("btnRegister").addEventListener("click", register);
    document.getElementById("btnLogin").addEventListener("click", login);
    document.getElementById("btnTopLogout").addEventListener("click", logout);

    // tabs
    document.querySelectorAll(".tab").forEach(b=>{
      b.addEventListener("click", ()=> navigate(b.getAttribute("data-page")));
    });

    // language switch
    const _lru=document.getElementById("lang_ru"); if(_lru) _lru.addEventListener("click", ()=> setLang("ru"));
    const _let=document.getElementById("lang_et"); if(_let) _let.addEventListener("click", ()=> setLang("et"));
    const _len=document.getElementById("lang_en"); if(_len) _len.addEventListener("click", ()=> setLang("en"));
    const langSelect=document.getElementById("langSelect");
    
// v1.118: language flag next to selector
const LANG_FLAGS = {"ru": "data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='12' viewBox='0 0 18 12'%3E %3Crect width='18' height='12' fill='%23fff'/%3E%3Crect width='18' height='8' y='4' fill='%230039A6'/%3E%3Crect width='18' height='4' y='8' fill='%23D52B1E'/%3E%3C/svg%3E", "et": "data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='12' viewBox='0 0 18 12'%3E %3Crect width='18' height='12' fill='%23fff'/%3E%3Crect width='18' height='4' fill='%230072CE'/%3E%3Crect width='18' height='4' y='4' fill='%23000'/%3E%3Crect width='18' height='4' y='8' fill='%23fff'/%3E%3C/svg%3E", "en": "data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='12' viewBox='0 0 18 12'%3E %3Crect width='18' height='12' fill='%23012169'/%3E %3Cpath d='M0,0 L18,12 M18,0 L0,12' stroke='%23fff' stroke-width='2.4'/%3E %3Cpath d='M0,0 L18,12 M18,0 L0,12' stroke='%23C8102E' stroke-width='1.2'/%3E %3Crect x='7.2' width='3.6' height='12' fill='%23fff'/%3E %3Crect y='4.2' width='18' height='3.6' fill='%23fff'/%3E %3Crect x='7.8' width='2.4' height='12' fill='%23C8102E'/%3E %3Crect y='4.8' width='18' height='2.4' fill='%23C8102E'/%3E %3C/svg%3E"};
function updateLangFlag_() {
  const sel = document.getElementById("langSelect");
  const img = document.getElementById("langFlag");
  if(!sel || !img) return;
  const v = sel.value || "et";
  img.src = LANG_FLAGS[v] || "";
  img.alt = v.toUpperCase();
}

window.addEventListener("load", () => { try{ updateLangFlag_(); }catch(e){} });
if(langSelect){
      langSelect.addEventListener("change", ()=> setLang(langSelect.value));
      try{ localStorage.setItem("ku_lang","et"); }catch(e){}
      langSelect.value = getLang();
    }

    // restore
    (function init(){
      applyLang();
      const saved = localStorage.getItem("ku_user");
      if(!saved){ showAuth(); return; }
      try{
        const user = JSON.parse(saved);
        if(user && user.username){ showApp(user); }
        else showAuth();
      }catch(_){
        showAuth();
      }
    })();
  
    // --- Forgot password (email reset) ---
// In-page modal (not browser prompt) so it won't disappear when switching windows.
// IMPORTANT: modal markup is placed AFTER this <script>, so DO NOT cache elements at load time.

const resetFlow = { stage: 1, identifier: "" }; // 1: ask identifier, 2: ask code

function getLang_() {
  return (window.lang || localStorage.getItem("lang") || "RU").toUpperCase();
}
function t_(key, fallback) {
  const L = getLang_();
  return (window.TEXT && window.TEXT[L] && window.TEXT[L][key]) || fallback || key;
}

function showReset_() {
  const m = byId("resetModal");
  if (!m) return;

  // reset state
  window.__resetIdentifier = "";
  const msg1 = byId("resetMsg");
  const msg2 = byId("resetMsg2");
  if (msg1) msg1.textContent = "";
  if (msg2) msg2.textContent = "";

  const step2 = byId("resetStep2");
  if (step2) step2.style.display = "none";

  const email = byId("resetEmail");
  const codeEl = byId("resetCode");
  const passEl = byId("resetNewPass");
  if (email) {
    email.type = "text";
    email.value = "";
  }
  if (codeEl) codeEl.value = "";
  if (passEl) passEl.value = "";

  const sendBtn = byId("resetSendBtn");
  const doBtn = byId("resetDoBtn");
  if (sendBtn) sendBtn.disabled = false;
  if (doBtn) doBtn.disabled = false;

  // Apply i18n to modal elements explicitly
  const titleEl = byId("resetTitle");
  const hintEl = byId("resetHint");
  const idLabel = byId("resetIdentifierLabel");
  const codeLabel = byId("resetCodeLabel");
  const newPassLabel = byId("resetNewPassLabel");

  if (titleEl) titleEl.textContent = tr("reset_title");
  if (hintEl) hintEl.textContent = tr("reset_desc");
  if (idLabel) idLabel.textContent = tr("username_or_email");
  if (codeLabel) codeLabel.textContent = tr("code");
  if (newPassLabel) newPassLabel.textContent = tr("new_password");
  if (sendBtn) sendBtn.textContent = tr("send_code");
  if (doBtn) doBtn.textContent = tr("continue");

  m.style.display = "block";
}

function hideReset_() {
  const m = byId("resetModal");
  if (!m) return;
  m.style.display = "none";
}

async function onSendCode_() {
  const idEl = byId("resetEmail");
  const msg1 = byId("resetMsg");
  const msg2 = byId("resetMsg2");
  const step2 = byId("resetStep2");
  const sendBtn = byId("resetSendBtn");

  const identifier = String(idEl && idEl.value ? idEl.value : "").trim();
  if (!identifier) {
    if (msg2) msg2.textContent = tr("missing_identifier");
    return;
  }

  // reset UI state
  if (msg1) msg1.textContent = tr("sending");
  if (msg2) msg2.textContent = "";
  if (step2) step2.style.display = "none";
  window.__resetIdentifier = ""; // will be set only on success

  if (sendBtn) sendBtn.disabled = true;

  try {
    const res = await apiCall("/forgot", { identifier, lang: getLang() });

    if (!res || res.ok !== true) {
      const err = (res && res.error) ? String(res.error) : "error";
      // show errors in the PRIMARY status area so it is always visible
      if (msg1) { msg1.style.color = "#b00020"; msg1.textContent = tr(err); }
      if (msg2) msg2.textContent = "";
      return;
    }

    // success: code sent
    window.__resetIdentifier = identifier;
    if (msg1) { msg1.style.color = ""; msg1.textContent = tr("code_sent"); }
    if (msg2) msg2.textContent = "";
    if (step2) step2.style.display = "block";

    const codeEl = byId("resetCode");
    if (codeEl) codeEl.focus();
  } catch (e) {
    if (msg1) msg1.textContent = "";
    if (msg2) msg2.textContent = tr("network_error");
  } finally {
    if (sendBtn) sendBtn.disabled = false;
  }
}

async function onVerifyCode_() {
  const idEl = byId("resetEmail");
  const codeEl = byId("resetCode");
  const passEl = byId("resetNewPass");
  const msg2 = byId("resetMsg2");
  const doBtn = byId("resetDoBtn");

  const identifier = (window.__resetIdentifier || (idEl && idEl.value) || "").toString().trim();
  const code = (codeEl && codeEl.value ? codeEl.value : "").toString().trim();
  const new_password = (passEl && passEl.value ? passEl.value : "").toString();

  if (!identifier) {
    if (msg2) msg2.textContent = tr("missing_identifier");
    return;
  }
  if (!code) {
    if (msg2) msg2.textContent = tr("missing_code");
    return;
  }
  if (!new_password || new_password.length < 6) {
    if (msg2) msg2.textContent = tr("password_too_short");
    return;
  }

  if (doBtn) doBtn.disabled = true;
  if (msg2) msg2.textContent = tr("verifying");

  try {
    const res = await apiCall("/reset", { identifier, code, new_password, lang: getLang() });

    if (!res || res.ok !== true) {
      const err = (res && res.error) ? String(res.error) : "error";
      if (msg2) { msg2.style.color = "#b00020"; msg2.textContent = tr(err); }
      return;
    }

    if (msg2) msg2.textContent = tr("password_reset_ok");

    // Close modal and clear state
    window.__resetIdentifier = "";
    setTimeout(() => {
      hideReset_();
      // Optional: prefill login username
      const loginUser = byId("loginUsername");
      if (loginUser && !loginUser.value) loginUser.value = identifier;

    }, 400);
  } catch (e) {
    if (msg2) msg2.textContent = tr("network_error");
  } finally {
    if (doBtn) doBtn.disabled = false;
  }
}

// Delegate clicks so language re-render won't break handlers
document.addEventListener("click", (e) => {
  const forgot = e.target && e.target.closest ? e.target.closest("#forgotLink") : null;
  if (forgot) { e.preventDefault(); showReset_(); return; }

  if (e.target && e.target.id === "resetSendBtn") { e.preventDefault(); onSendCode_(); return; }
  if (e.target && e.target.id === "resetDoBtn") { e.preventDefault(); onVerifyCode_(); return; }
  if (e.target && (e.target.id === "resetClose" || e.target.id === "resetX")) { e.preventDefault(); hideReset_(); return; }

  // Close only when clicking on overlay background (not when switching windows)
  if (e.target && e.target.id === "resetModal") { hideReset_(); return; }
});

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    const m = byId("resetModal");
    if (m && m.style.display === "block") hideReset_();
  }
});

</script>

  <div id="resetModal" class="modal" style="display:none">
    <div class="modal-backdrop" id="resetClose"></div>
    <div class="modal-card">
      <div class="modal-head">
        <div class="h2" data-i18n="reset_title">Password reset</div>
        <button class="iconbtn" id="resetX" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">
        <p class="muted" data-i18n="reset_desc">Enter the email used during registration. We will send a reset code.</p>

        <div class="field">
          <label><span data-i18n="username_or_email">Username or email</span></label>
          <input id="resetEmail" type="text" autocomplete="email" placeholder="name@example.com"/>
        </div>

        <div style="display:flex; gap:10px; align-items:center; margin-top:10px">
          <button class="btn primary" id="resetSendBtn" data-i18n="send_code">Send</button>
          <div class="muted" id="resetMsg" style="flex:1"></div>
        </div>

        <div id="resetStep2" style="display:none; margin-top:14px">
          <div class="grid2">
            <div class="field">
              <label><span data-i18n="code">Code</span></label>
              <input id="resetCode" type="text" inputmode="numeric" autocomplete="one-time-code" placeholder="123456"/>
            </div>
            <div class="field">
              <label><span data-i18n="new_password">New password</span></label>
              <input id="resetNewPass" type="password" autocomplete="new-password" placeholder="••••••••"/>
            </div>
          </div>
          <div style="display:flex; gap:10px; align-items:center; margin-top:10px">
            <button class="btn primary" id="resetDoBtn" data-i18n="continue">Reset password</button>
            <div class="muted" id="resetMsg2" style="flex:1"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>